<!doctype html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
        <title>Admin</title>
        <link rel="stylesheet" type="text/css" href="http://service.ihned.cz/js/alertify/v0.3.10.css" />
        <link rel="stylesheet" type="text/css" href="screen.css" />
        <link rel="stylesheet" type="text/css" href="http://service.ihned.cz/js/bootstrap/v2.3.2/css/bootstrap.min.css" />
        <script src="http://service.ihned.cz/js/jquery.min.js"></script>
        <script src="http://service.ihned.cz/js/jquery.eventEmitter.min.js"></script>
        <script src="http://service.ihned.cz/js/alertify/v0.3.10.min.js"></script>
        <script src="http://service.ihned.cz/js/jq-ui/jquery-ui.min.js"></script>
        <script src="http://service.ihned.cz/js/bootstrap/v2.3.2/js/bootstrap.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <style>
            .btn-success {
                margin-right: 20px;
            }
            .hidden {
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>HateCloud administrace</h1>
            <ul class="nav nav-tabs">
                <li id='sel-unapproved'>
                    <a href="#">Neschválené</a>
                </li>
            </ul>
            <div class="content" id='unapproved'>
                <table class='table'>
                    <thead>
                        <tr>
                            <th>Slovo</th>
                            <th>Akce</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <script>
        (function() {
            "use strict"
            var socket = io.connect();
            socket.on('shouts', function(shouts) {
                setDisplay("unapproved");
                var $table = $("#unapproved table");
                $table.find("tbody").empty();
                shouts.forEach(function(shout) {
                    var $row = $("<tr></tr>")
                        .data('term', shout.term)
                        .appendTo($table);
                    var $term = $("<td></td>")
                        .html(shout.term)
                        .appendTo($row);
                    var $actions = $("<td></td>")
                        .append("<button class='btn btn-success'>Schválit</button>")
                        .append("<button class='btn btn-danger'>Zamítnout</button>")
                        .appendTo($row);
                })
            })
            $(document).on('click', '.btn.btn-success', function() {
                var $ele = $(this);
                var term = getTerm($ele);
                socket.emit('approveTerm', term);
            })
            $(document).on('click', '.btn.btn-danger', function() {
                var $ele = $(this);
                var term = getTerm($ele);
                socket.emit('banTerm', term);
            })
            var getTerm = function($ele) {
                return $ele.parents('tr').data('term');
            }
            var setDisplay = function(name) {
                $(".content").addClass("hidden");
                $("nav.active").removeClass("active");
                $("#" + name).removeClass("hidden");
                $("#sel-" + name).addClass("active");
            }
        }())
        </script>
    </body>
</html>
